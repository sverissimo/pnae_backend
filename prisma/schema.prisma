generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Produtor {
  id             BigInt        @id @map("id_pessoa_demeter")
  nome           String        @map("nm_pessoa")
  cpfCnpj        String        @unique @map("nr_cpf_cnpj")
  tipoPessoa     TipoPessoa    @map("tp_pessoa")
  sexo           TipoSexo?     @map("tp_sexo")
  dataNascimento String?       @map("dt_nascimento")
  situacao       Int           @map("sn_ativo")
  caf            String?
  dap            String?
  municipioId    Int?          @map("id_municipio")
  propriedades   Propriedade[]
  relatorios     Relatorio[]
  Perfil         Perfil[]
}

model Propriedade {
  id              Int       @id
  produtorId      BigInt    @map("produtor_id")
  nomePropriedade String    @map("nome_propriedade")
  coordenadas     String?   @map("geo_ponto_texto")
  area            String?   @map("area_total")
  municipioId     Int?      @map("id_municipio")
  produtor        Produtor? @relation(fields: [produtorId], references: [id])
}

model Relatorio {
  id              Int           @id @default(autoincrement())
  numeroRelatorio Int           @map("nr_relatorio")
  assunto         String
  orientacao      String
  produtor        Produtor?     @relation(fields: [produtorId], references: [id])
  produtorId      BigInt        @map("produtor_id")
  files           PictureFile[]
  createdAt       DateTime?     @default(now()) @map("created_at")
}

model PictureFile {
  id          String             @id @default(uuid())
  fileName    String
  size        Float
  mimeType    String
  description PictureDescription
  relatorio   Relatorio?         @relation(fields: [relatorioId], references: [id])
  relatorioId Int                @map("relatorio_id")
  updloadDate DateTime?          @default(now()) @map("upload_date")
}

model Tecnico {
  id   Int    @id @default(autoincrement())
  nome String
  cpf  String
  masp String
}

enum TipoPessoa {
  F
  J
}

enum TipoSexo {
  F
  M
}

enum PictureDescription {
  FOTO_RELATORIO
  ASSINATURA_PRODUTOR
}

enum Sexo {
  MASCULINO
  FEMININO
  NAO_INFORMADO
}

model Perfil {
  id                                           Int            @id @default(autoincrement())
  tipo_perfil                                  String
  id_tecnico                                   Int
  id_cliente                                   BigInt
  produtor                                     Produtor       @relation(fields: [id_cliente], references: [id])
  data_preenchimento                           DateTime
  data_atualizacao                             DateTime
  participa_organizacao                        Boolean
  id_dados_producao_in_natura                  Int?
  nivel_tecnologico_cultivo                    Int?
  sistema_producao                             Int?
  condicao_posse                               Int?
  dap_caf_vigente                              Boolean?
  credito_rural                                Boolean?
  fonte_captacao_agua                          Int?
  forma_esgotamento_sanitario                  Int?
  possui_cadastro_car                          Boolean?
  aderiu_pra                                   Boolean?
  ciente_iniciativas_regularizacao_pra         Boolean?
  realiza_escalonamento_producao               Boolean?
  procedimento_pos_colheita                    Int?
  tipo_gestao_unidade                          String?
  pessoas_processamento_alimentos              Int?
  tipo_estabelecimento                         String?
  tipo_pessoa_juridica                         String?
  agroindustria_precisa_adaptacao_reforma      Boolean?
  possui_registro_orgao_fiscalizacao_sanitaria Boolean?
  orgao_fiscalizacao_sanitaria                 String?
  atividades_usam_recursos_hidricos            Int?
  atividades_com_regularizacao_ambiental       Int?
  possui_agroindustria_propria                 Boolean?
  grau_interesse_pnae                          String
  id_dados_producao_agro_industria             Int?           @unique()
  dados_producao                               DadosProducao? @relation(fields: [id_dados_producao_agro_industria], references: [id])
  atividade                                    Atividade?
}

model DadosProducao {
  id                                       Int     @id //@default(autoincrement())
  controla_custos_producao                 Boolean
  dificuldade_fornecimento                 Int
  forma_entrega_produtos                   Int
  informacoes_adicionais                   String?
  local_comercializacao                    Int
  perfil                                   Perfil?
  tipo_regularizacao_ambiental             String
  tipo_regularizacao_uso_recursos_hidricos String
  valor_total_obtido_outros                Int
  valor_total_obtido_pnae                  Int
}

model Atividade {
  id                     Int      @id
  id_perfil_see          Int      @unique
  id_propriedade         Int      @unique
  atividade              String
  producao_dedicada_pnae Boolean?
  perfil                 Perfil   @relation(fields: [id_perfil_see], references: [id])
}
